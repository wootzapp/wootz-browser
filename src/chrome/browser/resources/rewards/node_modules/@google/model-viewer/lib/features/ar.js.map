{"version":3,"file":"ar.js","sourceRoot":"","sources":["../../src/features/ar.ts"],"names":[],"mappings":"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","sourcesContent":["/* @license\n * Copyright 2019 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the 'License');\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an 'AS IS' BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {property} from 'lit/decorators.js';\nimport {Event as ThreeEvent} from 'three';\nimport {USDZExporter} from 'three/examples/jsm/exporters/USDZExporter.js';\n\nimport {IS_AR_QUICKLOOK_CANDIDATE, IS_SCENEVIEWER_CANDIDATE, IS_WEBXR_AR_CANDIDATE} from '../constants.js';\nimport ModelViewerElementBase, {$needsRender, $progressTracker, $renderer, $scene, $shouldAttemptPreload, $updateSource} from '../model-viewer-base.js';\nimport {enumerationDeserializer} from '../styles/deserializers.js';\nimport {ARStatus, ARTracking} from '../three-components/ARRenderer.js';\nimport {Constructor, waitForEvent} from '../utilities.js';\n\nlet isWebXRBlocked = false;\nlet isSceneViewerBlocked = false;\nconst noArViewerSigil = '#model-viewer-no-ar-fallback';\n\nexport type ARMode = 'quick-look'|'scene-viewer'|'webxr'|'none';\n\nconst deserializeARModes = enumerationDeserializer<ARMode>(\n    ['quick-look', 'scene-viewer', 'webxr', 'none']);\n\nconst DEFAULT_AR_MODES = 'webxr scene-viewer quick-look';\n\nconst ARMode: {[index: string]: ARMode} = {\n  QUICK_LOOK: 'quick-look',\n  SCENE_VIEWER: 'scene-viewer',\n  WEBXR: 'webxr',\n  NONE: 'none'\n};\n\nexport interface ARStatusDetails {\n  status: ARStatus;\n}\n\nexport interface ARTrackingDetails {\n  status: ARTracking;\n}\n\nconst $arButtonContainer = Symbol('arButtonContainer');\nconst $enterARWithWebXR = Symbol('enterARWithWebXR');\nexport const $openSceneViewer = Symbol('openSceneViewer');\nexport const $openIOSARQuickLook = Symbol('openIOSARQuickLook');\nconst $canActivateAR = Symbol('canActivateAR');\nconst $arMode = Symbol('arMode');\nconst $arModes = Symbol('arModes');\nconst $arAnchor = Symbol('arAnchor');\nconst $preload = Symbol('preload');\n\nconst $onARButtonContainerClick = Symbol('onARButtonContainerClick');\nconst $onARStatus = Symbol('onARStatus');\nconst $onARTracking = Symbol('onARTracking');\nconst $onARTap = Symbol('onARTap');\nconst $selectARMode = Symbol('selectARMode');\nconst $triggerLoad = Symbol('triggerLoad');\n\nexport declare interface ARInterface {\n  ar: boolean;\n  arModes: string;\n  arScale: string;\n  arPlacement: string;\n  iosSrc: string|null;\n  xrEnvironment: boolean;\n  readonly canActivateAR: boolean;\n  activateAR(): Promise<void>;\n}\n\nexport const ARMixin = <T extends Constructor<ModelViewerElementBase>>(\n    ModelViewerElement: T): Constructor<ARInterface>&T => {\n  class ARModelViewerElement extends ModelViewerElement {\n    @property({type: Boolean, attribute: 'ar'}) ar: boolean = false;\n\n    @property({type: String, attribute: 'ar-scale'}) arScale: string = 'auto';\n\n    @property({type: String, attribute: 'ar-placement'})\n    arPlacement: string = 'floor';\n\n    @property({type: String, attribute: 'ar-modes'})\n    arModes: string = DEFAULT_AR_MODES;\n\n    @property({type: String, attribute: 'ios-src'}) iosSrc: string|null = null;\n\n    @property({type: Boolean, attribute: 'xr-environment'})\n    xrEnvironment: boolean = false;\n\n    get canActivateAR(): boolean {\n      return this[$arMode] !== ARMode.NONE;\n    }\n\n    protected[$canActivateAR]: boolean = false;\n\n    // TODO: Add this to the shadow root as part of this mixin's\n    // implementation:\n    protected[$arButtonContainer]: HTMLElement =\n        this.shadowRoot!.querySelector('.ar-button') as HTMLElement;\n\n    protected[$arAnchor] = document.createElement('a');\n\n    protected[$arModes]: Set<ARMode> = new Set();\n    protected[$arMode]: ARMode = ARMode.NONE;\n    protected[$preload] = false;\n\n    private[$onARButtonContainerClick] = (event: Event) => {\n      event.preventDefault();\n      this.activateAR();\n    };\n\n    private[$onARStatus] = ({status}: ThreeEvent) => {\n      if (status === ARStatus.NOT_PRESENTING ||\n          this[$renderer].arRenderer.presentedScene === this[$scene]) {\n        this.setAttribute('ar-status', status);\n        this.dispatchEvent(\n            new CustomEvent<ARStatusDetails>('ar-status', {detail: {status}}));\n        if (status === ARStatus.NOT_PRESENTING) {\n          this.removeAttribute('ar-tracking');\n        } else if (status === ARStatus.SESSION_STARTED) {\n          this.setAttribute('ar-tracking', ARTracking.TRACKING);\n        }\n      }\n    };\n\n    private[$onARTracking] = ({status}: ThreeEvent) => {\n      this.setAttribute('ar-tracking', status);\n      this.dispatchEvent(new CustomEvent<ARTrackingDetails>(\n          'ar-tracking', {detail: {status}}));\n    };\n\n    private[$onARTap] = (event: Event) => {\n      if ((event as any).data == '_apple_ar_quicklook_button_tapped') {\n        this.dispatchEvent(new CustomEvent('quick-look-button-tapped'));\n      }\n    };\n\n    connectedCallback() {\n      super.connectedCallback();\n\n      this[$renderer].arRenderer.addEventListener('status', this[$onARStatus]);\n      this.setAttribute('ar-status', ARStatus.NOT_PRESENTING);\n\n      this[$renderer].arRenderer.addEventListener(\n          'tracking', this[$onARTracking]);\n\n      this[$arAnchor].addEventListener('message', this[$onARTap]);\n    }\n\n    disconnectedCallback() {\n      super.disconnectedCallback();\n\n      this[$renderer].arRenderer.removeEventListener(\n          'status', this[$onARStatus]);\n      this[$renderer].arRenderer.removeEventListener(\n          'tracking', this[$onARTracking]);\n\n      this[$arAnchor].removeEventListener('message', this[$onARTap]);\n    }\n\n    update(changedProperties: Map<string, any>) {\n      super.update(changedProperties);\n\n      if (changedProperties.has('arScale')) {\n        this[$scene].canScale = this.arScale !== 'fixed';\n      }\n\n      if (changedProperties.has('arPlacement')) {\n        this[$scene].updateShadow();\n        this[$needsRender]();\n      }\n\n      if (changedProperties.has('arModes')) {\n        this[$arModes] = deserializeARModes(this.arModes);\n      }\n\n      if (changedProperties.has('ar') || changedProperties.has('arModes') ||\n          changedProperties.has('src') || changedProperties.has('iosSrc')) {\n        this[$selectARMode]();\n      }\n    }\n\n    /**\n     * Activates AR. Note that for any mode that is not WebXR-based, this\n     * method most likely has to be called synchronous from a user\n     * interaction handler. Otherwise, attempts to activate modes that\n     * require user interaction will most likely be ignored.\n     */\n    async activateAR() {\n      switch (this[$arMode]) {\n        case ARMode.QUICK_LOOK:\n          this[$openIOSARQuickLook]();\n          break;\n        case ARMode.WEBXR:\n          await this[$enterARWithWebXR]();\n          break;\n        case ARMode.SCENE_VIEWER:\n          this[$openSceneViewer]();\n          break;\n        default:\n          console.warn(\n              'No AR Mode can be activated. This is probably due to missing \\\nconfiguration or device capabilities');\n          break;\n      }\n    }\n\n    async[$selectARMode]() {\n      let arMode = ARMode.NONE;\n      if (this.ar) {\n        if (this.src != null) {\n          for (const value of this[$arModes]) {\n            if (value === 'webxr' && IS_WEBXR_AR_CANDIDATE && !isWebXRBlocked &&\n                await this[$renderer].arRenderer.supportsPresentation()) {\n              arMode = ARMode.WEBXR;\n              break;\n            }\n            if (value === 'scene-viewer' && IS_SCENEVIEWER_CANDIDATE &&\n                !isSceneViewerBlocked) {\n              arMode = ARMode.SCENE_VIEWER;\n              break;\n            }\n            if (value === 'quick-look' && IS_AR_QUICKLOOK_CANDIDATE) {\n              arMode = ARMode.QUICK_LOOK;\n              break;\n            }\n          }\n        }\n\n        // The presence of ios-src overrides the absence of quick-look\n        // ar-mode.\n        if (arMode === ARMode.NONE && this.iosSrc != null &&\n            IS_AR_QUICKLOOK_CANDIDATE) {\n          arMode = ARMode.QUICK_LOOK;\n        }\n      }\n\n      if (arMode !== ARMode.NONE) {\n        this[$arButtonContainer].classList.add('enabled');\n        this[$arButtonContainer].addEventListener(\n            'click', this[$onARButtonContainerClick]);\n      } else if (this[$arButtonContainer].classList.contains('enabled')) {\n        this[$arButtonContainer].removeEventListener(\n            'click', this[$onARButtonContainerClick]);\n        this[$arButtonContainer].classList.remove('enabled');\n\n        // If AR went from working to not, notify the element.\n        const status = ARStatus.FAILED;\n        this.setAttribute('ar-status', status);\n        this.dispatchEvent(\n            new CustomEvent<ARStatusDetails>('ar-status', {detail: {status}}));\n      }\n      this[$arMode] = arMode;\n    }\n\n    protected async[$enterARWithWebXR]() {\n      console.log('Attempting to present in AR with WebXR...');\n\n      await this[$triggerLoad]();\n\n      try {\n        this[$arButtonContainer].removeEventListener(\n            'click', this[$onARButtonContainerClick]);\n        const {arRenderer} = this[$renderer];\n        arRenderer.placeOnWall = this.arPlacement === 'wall';\n        await arRenderer.present(this[$scene], this.xrEnvironment);\n      } catch (error) {\n        console.warn('Error while trying to present in AR with WebXR');\n        console.error(error);\n        await this[$renderer].arRenderer.stopPresenting();\n        isWebXRBlocked = true;\n        console.warn('Falling back to next ar-mode');\n        await this[$selectARMode]();\n        this.activateAR();\n      } finally {\n        this[$selectARMode]();\n      }\n    }\n\n    async[$triggerLoad]() {\n      if (!this.loaded) {\n        this[$preload] = true;\n        this[$updateSource]();\n        await waitForEvent(this, 'load');\n        this[$preload] = false;\n      }\n    }\n\n    [$shouldAttemptPreload](): boolean {\n      return super[$shouldAttemptPreload]() || this[$preload];\n    }\n\n    /**\n     * Takes a URL and a title string, and attempts to launch Scene Viewer on\n     * the current device.\n     */\n    [$openSceneViewer]() {\n      const location = self.location.toString();\n      const locationUrl = new URL(location);\n      const modelUrl = new URL(this.src!, location);\n      const params = new URLSearchParams(modelUrl.search);\n\n      locationUrl.hash = noArViewerSigil;\n\n      // modelUrl can contain title/link/sound etc.\n      params.set('mode', 'ar_preferred');\n      if (!params.has('disable_occlusion')) {\n        params.set('disable_occlusion', 'true');\n      }\n      if (this.arScale === 'fixed') {\n        params.set('resizable', 'false');\n      }\n      if (this.arPlacement === 'wall') {\n        params.set('enable_vertical_placement', 'true');\n      }\n      if (params.has('sound')) {\n        const soundUrl = new URL(params.get('sound')!, location);\n        params.set('sound', soundUrl.toString());\n      }\n      if (params.has('link')) {\n        const linkUrl = new URL(params.get('link')!, location);\n        params.set('link', linkUrl.toString());\n      }\n\n      const intent = `intent://arvr.google.com/scene-viewer/1.0?${\n          params.toString() + '&file=' +\n          encodeURIComponent(\n              modelUrl\n                  .toString())}#Intent;scheme=https;package=com.google.ar.core;action=android.intent.action.VIEW;S.browser_fallback_url=${\n          encodeURIComponent(locationUrl.toString())};end;`;\n\n      const undoHashChange = () => {\n        if (self.location.hash === noArViewerSigil) {\n          isSceneViewerBlocked = true;\n          // The new history will be the current URL with a new hash.\n          // Go back one step so that we reset to the expected URL.\n          // NOTE(cdata): this should not invoke any browser-level navigation\n          // because hash-only changes modify the URL in-place without\n          // navigating:\n          self.history.back();\n          console.warn('Error while trying to present in AR with Scene Viewer');\n          console.warn('Falling back to next ar-mode');\n          this[$selectARMode]();\n          // Would be nice to activateAR() here, but webXR fails due to not\n          // seeing a user activation.\n        }\n      };\n\n      self.addEventListener('hashchange', undoHashChange, {once: true});\n\n      this[$arAnchor].setAttribute('href', intent);\n      console.log('Attempting to present in AR with Scene Viewer...');\n      this[$arAnchor].click();\n    }\n\n    /**\n     * Takes a URL to a USDZ file and sets the appropriate fields so that\n     * Safari iOS can intent to their AR Quick Look.\n     */\n    async[$openIOSARQuickLook]() {\n      const generateUsdz = !this.iosSrc;\n\n      this[$arButtonContainer].classList.remove('enabled');\n\n      const objectURL = generateUsdz ? await this.prepareUSDZ() : this.iosSrc!;\n      const modelUrl = new URL(objectURL, self.location.toString());\n\n      if (generateUsdz) {\n        const location = self.location.toString();\n        const locationUrl = new URL(location);\n        const srcUrl = new URL(this.src!, locationUrl);\n        if (srcUrl.hash) {\n          modelUrl.hash = srcUrl.hash;\n        }\n      }\n\n      if (this.arScale === 'fixed') {\n        if (modelUrl.hash) {\n          modelUrl.hash += '&';\n        }\n        modelUrl.hash += 'allowsContentScaling=0';\n      }\n\n      const anchor = this[$arAnchor];\n      anchor.setAttribute('rel', 'ar');\n      const img = document.createElement('img');\n      anchor.appendChild(img);\n      anchor.setAttribute('href', modelUrl.toString());\n      if (generateUsdz) {\n        anchor.setAttribute('download', 'model.usdz');\n      }\n\n      // attach anchor to shadow DOM to ensure iOS16 ARQL banner click message event propagation \n      anchor.style.display = 'none';\n      if(!anchor.isConnected) this.shadowRoot!.appendChild(anchor);\n\n      console.log('Attempting to present in AR with Quick Look...');\n      anchor.click();\n      anchor.removeChild(img);\n      if (generateUsdz) {\n        URL.revokeObjectURL(objectURL);\n      }\n      this[$arButtonContainer].classList.add('enabled');\n    }\n\n    async prepareUSDZ(): Promise<string> {\n      const updateSourceProgress = this[$progressTracker].beginActivity();\n\n      await this[$triggerLoad]();\n\n      const {model, shadow} = this[$scene];\n      if (model == null) {\n        return '';\n      }\n\n      let visible = false;\n\n      // Remove shadow from export\n      if (shadow != null) {\n        visible = shadow.visible;\n        shadow.visible = false;\n      }\n\n      updateSourceProgress(0.2);\n\n      const exporter = new USDZExporter();\n      const arraybuffer = await exporter.parse(model);\n      const blob = new Blob([arraybuffer], {\n        type: 'model/vnd.usdz+zip',\n      });\n\n      const url = URL.createObjectURL(blob);\n\n      updateSourceProgress(1);\n\n      if (shadow != null) {\n        shadow.visible = visible;\n      }\n\n      return url;\n    }\n  }\n\n  return ARModelViewerElement;\n};\n"]}