{"version":3,"file":"staging-spec.js","sourceRoot":"","sources":["../../../src/test/features/staging-spec.ts"],"names":[],"mappings":"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","sourcesContent":["/* @license\n * Copyright 2019 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the 'License');\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an 'AS IS' BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {CameraChangeDetails} from '../../features/controls.js';\nimport {ModelViewerElement} from '../../model-viewer.js';\nimport {ChangeSource} from '../../three-components/SmoothControls.js';\nimport {timePasses, waitForEvent} from '../../utilities.js';\nimport {assetPath, rafPasses} from '../helpers.js';\n\nconst expect = chai.expect;\n\nconst ODD_SHAPE_GLB_PATH = assetPath('models/odd-shape.glb');\nconst AUTO_ROTATE_DELAY = 50;\n\nsuite('Staging', () => {\n  suite('with a visible loaded model', () => {\n    let element: ModelViewerElement;\n\n    setup(async () => {\n      element = new ModelViewerElement();\n      element.src = ODD_SHAPE_GLB_PATH;\n      document.body.insertBefore(element, document.body.firstChild);\n\n      await waitForEvent(element, 'poster-dismissed');\n      await rafPasses();\n    });\n\n    teardown(() => {\n      document.body.removeChild(element);\n    });\n\n    test('can manually rotate turntable', () => {\n      element.resetTurntableRotation(3);\n      expect(element.turntableRotation).to.be.equal(3);\n\n      element.resetTurntableRotation();\n      expect(element.turntableRotation).to.be.equal(0);\n    });\n\n    suite('auto-rotate', () => {\n      setup(async () => {\n        element.autoRotate = true;\n        element.autoRotateDelay = AUTO_ROTATE_DELAY;\n        await timePasses();\n      });\n\n      test('causes the model to rotate after a delay', async () => {\n        const {turntableRotation} = element;\n        await rafPasses();\n        expect(element.turntableRotation).to.be.equal(turntableRotation);\n        await timePasses(AUTO_ROTATE_DELAY);\n        await rafPasses();\n        expect(element.turntableRotation).to.be.greaterThan(turntableRotation);\n      });\n\n      // TODO(#1205)\n      test.skip(\n          'retains turntable rotation when auto-rotate is toggled',\n          async () => {\n            element.autoRotateDelay = 0;\n            await timePasses();\n            await rafPasses();\n\n            const {turntableRotation} = element;\n\n            expect(turntableRotation).to.be.greaterThan(0);\n\n            element.autoRotate = false;\n            await timePasses();\n            await rafPasses();\n\n            expect(element.turntableRotation).to.be.equal(turntableRotation);\n\n            element.autoRotate = true;\n            await timePasses();\n            await rafPasses();\n\n            expect(element.turntableRotation)\n                .to.be.greaterThan(turntableRotation);\n          });\n\n      // TODO(#1206)\n      test.skip('pauses rotate after user interaction', async () => {\n        const {turntableRotation} = element;\n        await timePasses(AUTO_ROTATE_DELAY);\n        await rafPasses();\n\n        const {turntableRotation: initialTurntableRotation} = element;\n        expect(initialTurntableRotation).to.be.greaterThan(turntableRotation);\n\n        element.dispatchEvent(new CustomEvent<CameraChangeDetails>(\n            'camera-change',\n            {detail: {source: ChangeSource.USER_INTERACTION}}));\n        await timePasses();\n\n        await rafPasses();\n\n        expect(element.turntableRotation).to.be.equal(initialTurntableRotation);\n\n        await timePasses(AUTO_ROTATE_DELAY);\n        await rafPasses();\n\n        expect(element.turntableRotation)\n            .to.be.greaterThan(initialTurntableRotation);\n      });\n\n      suite('when the model is not visible', () => {\n        setup(() => {\n          Object.defineProperty(element, 'modelIsVisible', {value: false});\n        });\n\n        test('does not cause the model to rotate over time', async () => {\n          const {turntableRotation} = element;\n\n          await timePasses(AUTO_ROTATE_DELAY);\n          await rafPasses();\n\n          expect(element.turntableRotation).to.be.equal(turntableRotation);\n        });\n      });\n\n      suite('with zero auto-rotate-delay', () => {\n        setup(async () => {\n          element.autoRotateDelay = 0;\n          await timePasses();\n          await rafPasses();\n        });\n\n        test('causes the model to rotate ASAP', async () => {\n          const {turntableRotation} = element;\n          await rafPasses();\n          expect(element.turntableRotation)\n              .to.be.greaterThan(turntableRotation);\n        });\n      });\n    });\n  });\n});\n"]}