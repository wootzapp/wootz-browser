{"version":3,"file":"annotation-spec.js","sourceRoot":"","sources":["../../../src/test/features/annotation-spec.ts"],"names":[],"mappings":"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","sourcesContent":["/* @license\n * Copyright 2019 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the 'License');\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an 'AS IS' BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {Vector3} from 'three';\n\nimport {ModelViewerElement} from '../../model-viewer';\nimport {$needsRender, $scene, toVector3D, Vector2D, Vector3D} from '../../model-viewer-base';\nimport {Hotspot} from '../../three-components/Hotspot.js';\nimport {ModelScene} from '../../three-components/ModelScene';\nimport {timePasses, waitForEvent} from '../../utilities';\nimport {assetPath, rafPasses} from '../helpers';\n\nconst expect = chai.expect;\n\nconst sceneContainsHotspot =\n    (scene: ModelScene, element: HTMLElement): boolean => {\n      const {children} = scene.target;\n      for (let i = 0, l = children.length; i < l; i++) {\n        const hotspot = children[i];\n        if (hotspot instanceof Hotspot &&\n            (hotspot.element.children[0].children[0] as HTMLSlotElement)\n                    .name === element.slot) {\n          // expect it has been changed from default\n          expect(hotspot.position).to.not.eql(new Vector3());\n          expect(hotspot.normal).to.not.eql(new Vector3(0, 1, 0));\n          return true;\n        }\n      }\n      return false;\n    };\n\nconst closeToVector3 = (a: Vector3D, b: Vector3) => {\n  const delta = 0.001;\n  expect(a.x).to.be.closeTo(b.x, delta);\n  expect(a.y).to.be.closeTo(b.y, delta);\n  expect(a.z).to.be.closeTo(b.z, delta);\n};\n\nconst withinRange = (a: Vector2D, start: number, finish: number) => {\n  expect(a.u).to.be.within(start, finish);\n  expect(a.v).to.be.within(start, finish);\n};\n\nsuite('Annotation', () => {\n  let element: ModelViewerElement;\n  let scene: ModelScene;\n\n  setup(async () => {\n    element = new ModelViewerElement();\n    document.body.insertBefore(element, document.body.firstChild);\n    scene = element[$scene];\n\n    element.src = assetPath('models/cube.gltf');\n    await waitForEvent(element, 'poster-dismissed');\n  });\n\n  teardown(() => {\n    if (element.parentNode != null) {\n      element.parentNode.removeChild(element);\n    }\n  });\n\n  suite('a model-viewer element with a hotspot', () => {\n    let hotspot: HTMLElement;\n    let numSlots: number;\n\n    setup(async () => {\n      hotspot = document.createElement('div');\n      hotspot.setAttribute('slot', 'hotspot-1');\n      hotspot.setAttribute('data-position', '1m 1m 1m');\n      hotspot.setAttribute('data-normal', '0m 0m -1m');\n      element.appendChild(hotspot);\n      await timePasses();\n      numSlots = scene.target.children.length;\n    });\n\n    teardown(() => {\n      if (hotspot.parentElement === element) {\n        element.removeChild(hotspot);\n      }\n    });\n\n    test('creates a corresponding slot', () => {\n      expect(sceneContainsHotspot(scene, hotspot)).to.be.true;\n    });\n\n    test('querying it returns valid data', () => {\n      // to test querying, place hotspot in the center and verify the screen\n      // position is half the default width and height (300 x 150) with a depth\n      // value of ~1.\n      const defaultDimensions = {width: 300, height: 150};\n      element.updateHotspot({name: 'hotspot-1', position: `0m 0m 0m`});\n\n      const hotspotData = element.queryHotspot('hotspot-1');\n\n      expect(hotspotData?.canvasPosition.x)\n          .to.be.closeTo(defaultDimensions.width / 2, 0.0001);\n      expect(hotspotData?.canvasPosition.y)\n          .to.be.closeTo(defaultDimensions.height / 2, 0.0001);\n      expect(hotspotData?.position.toString())\n          .to.equal(toVector3D(new Vector3(0, 0, 0)).toString());\n      expect(hotspotData?.normal.toString())\n          .to.equal(toVector3D(new Vector3(0, 0, -1)).toString());\n      expect(hotspotData?.facingCamera).to.be.true;\n    });\n\n    suite('adding a second hotspot with the same name', () => {\n      let hotspot2: HTMLElement;\n\n      setup(async () => {\n        hotspot2 = document.createElement('div');\n        hotspot2.setAttribute('slot', 'hotspot-1');\n        hotspot2.setAttribute('data-position', '0m 1m 2m');\n        hotspot2.setAttribute('data-normal', '1m 0m 0m');\n        element.appendChild(hotspot2);\n        await timePasses();\n      });\n\n      teardown(() => {\n        if (hotspot2.parentElement === element) {\n          element.removeChild(hotspot2);\n        }\n      });\n\n      test('does not change the slot', () => {\n        expect(scene.target.children.length).to.be.equal(numSlots);\n      });\n\n      test('does not change the data', () => {\n        const {position, normal} =\n            (scene.target.children[numSlots - 1] as Hotspot);\n        expect(position).to.be.deep.equal(new Vector3(1, 1, 1));\n        expect(normal).to.be.deep.equal(new Vector3(0, 0, -1));\n      });\n\n      test('updateHotspot does change the data', () => {\n        element.updateHotspot(\n            {name: 'hotspot-1', position: '0m 1m 2m', normal: '1m 0m 0m'});\n        const {position, normal} =\n            (scene.target.children[numSlots - 1] as Hotspot);\n        expect(position).to.be.deep.equal(new Vector3(0, 1, 2));\n        expect(normal).to.be.deep.equal(new Vector3(1, 0, 0));\n      });\n\n      test('and removing it does not remove the slot', async () => {\n        element.removeChild(hotspot);\n        await timePasses();\n\n        expect(scene.target.children.length).to.be.equal(numSlots);\n      });\n\n      test('but removing both does remove the slot', async () => {\n        element.removeChild(hotspot);\n        element.removeChild(hotspot2);\n        await timePasses();\n\n        expect(scene.target.children.length).to.be.equal(numSlots - 1);\n      });\n\n      suite('with a camera', () => {\n        let wrapper: HTMLElement;\n\n        setup(async () => {\n          // This is to wait for the hotspots to be added to their slots, as\n          // this triggers their visibility to \"show\". Otherwise, sometimes the\n          // following hide() call will happen first, then when the camera\n          // moves, we never get a hotspot-visibility event because they were\n          // already visible.\n          await rafPasses();\n\n          wrapper = (scene.target.children[numSlots - 1] as Hotspot).element;\n        });\n\n        test('the hotspot is hidden', async () => {\n          expect(wrapper.classList.contains('hide')).to.be.true;\n        });\n\n        test('the hotspot is visible after turning', async () => {\n          element[$scene].yaw = Math.PI;\n          element[$scene].updateMatrixWorld();\n          element[$needsRender]();\n\n          await waitForEvent(hotspot2, 'hotspot-visibility');\n\n          expect(!!wrapper.classList.contains('hide')).to.be.false;\n        });\n      });\n    });\n  });\n\n  suite('a model-viewer element with a loaded cube', () => {\n    let width = 0;\n    let height = 0;\n\n    setup(async () => {\n      width = 200;\n      height = 300;\n      element.setAttribute('style', `width: ${width}px; height: ${height}px`);\n      element.cameraOrbit = '0deg 90deg 2m';\n      element.jumpCameraToGoal();\n      await rafPasses();\n    });\n\n    test('gets expected hit result', async () => {\n      await rafPasses();\n      const hitResult =\n          element.positionAndNormalFromPoint(width / 2, height / 2);\n      expect(hitResult).to.be.ok;\n      const {position, normal, uv} = hitResult!;\n      closeToVector3(position, new Vector3(0, 0, 0.5));\n      closeToVector3(normal, new Vector3(0, 0, 1));\n      if (uv != null) {\n        withinRange(uv, 0, 1);\n      }\n    });\n\n    test('gets expected hit result when turned', async () => {\n      element.resetTurntableRotation(-Math.PI / 2);\n      await rafPasses();\n      const hitResult =\n          element.positionAndNormalFromPoint(width / 2, height / 2);\n      expect(hitResult).to.be.ok;\n      const {position, normal, uv} = hitResult!;\n      closeToVector3(position, new Vector3(0.5, 0, 0));\n      closeToVector3(normal, new Vector3(1, 0, 0));\n      if (uv != null) {\n        withinRange(uv, 0, 1);\n      }\n    });\n  });\n});\n"]}