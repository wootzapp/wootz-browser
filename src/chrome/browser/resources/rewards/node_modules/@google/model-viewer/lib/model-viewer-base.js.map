{"version":3,"file":"model-viewer-base.js","sourceRoot":"","sources":["../src/model-viewer-base.ts"],"names":[],"mappings":"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","sourcesContent":["/* @license\n * Copyright 2019 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the 'License');\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an 'AS IS' BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {ReactiveElement} from 'lit';\nimport {property} from 'lit/decorators.js';\nimport {Event as ThreeEvent, Vector2, Vector3} from 'three';\n\nimport {HAS_INTERSECTION_OBSERVER, HAS_RESIZE_OBSERVER} from './constants.js';\nimport {$updateEnvironment} from './features/environment.js';\nimport {makeTemplate} from './template.js';\nimport {$evictionPolicy, CachingGLTFLoader} from './three-components/CachingGLTFLoader.js';\nimport {ModelScene} from './three-components/ModelScene.js';\nimport {ContextLostEvent, Renderer} from './three-components/Renderer.js';\nimport {clamp, debounce} from './utilities.js';\nimport {dataUrlToBlob} from './utilities/data-conversion.js';\nimport {ProgressTracker} from './utilities/progress-tracker.js';\n\nconst CLEAR_MODEL_TIMEOUT_MS = 1000;\nconst FALLBACK_SIZE_UPDATE_THRESHOLD_MS = 50;\nconst ANNOUNCE_MODEL_VISIBILITY_DEBOUNCE_THRESHOLD = 0;\nconst UNSIZED_MEDIA_WIDTH = 300;\nconst UNSIZED_MEDIA_HEIGHT = 150;\n\nexport const blobCanvas = document.createElement('canvas');\n\nconst $fallbackResizeHandler = Symbol('fallbackResizeHandler');\nconst $defaultAriaLabel = Symbol('defaultAriaLabel');\n\nconst $resizeObserver = Symbol('resizeObserver');\nconst $clearModelTimeout = Symbol('clearModelTimeout');\nconst $onContextLost = Symbol('onContextLost');\nconst $loaded = Symbol('loaded');\nconst $status = Symbol('status');\nconst $onFocus = Symbol('onFocus');\nconst $onBlur = Symbol('onBlur');\n\nexport const $updateSize = Symbol('updateSize');\nexport const $intersectionObserver = Symbol('intersectionObserver');\nexport const $isElementInViewport = Symbol('isElementInViewport');\nexport const $announceModelVisibility = Symbol('announceModelVisibility');\nexport const $ariaLabel = Symbol('ariaLabel');\nexport const $altDefaulted = Symbol('altDefaulted');\nexport const $statusElement = Symbol('statusElement');\nexport const $updateStatus = Symbol('updateStatus');\nexport const $loadedTime = Symbol('loadedTime');\nexport const $updateSource = Symbol('updateSource');\nexport const $markLoaded = Symbol('markLoaded');\nexport const $container = Symbol('container');\nexport const $userInputElement = Symbol('input');\nexport const $canvas = Symbol('canvas');\nexport const $scene = Symbol('scene');\nexport const $needsRender = Symbol('needsRender');\nexport const $tick = Symbol('tick');\nexport const $onModelLoad = Symbol('onModelLoad');\nexport const $onResize = Symbol('onResize');\nexport const $renderer = Symbol('renderer');\nexport const $progressTracker = Symbol('progressTracker');\nexport const $getLoaded = Symbol('getLoaded');\nexport const $getModelIsVisible = Symbol('getModelIsVisible');\nexport const $shouldAttemptPreload = Symbol('shouldAttemptPreload');\n\nexport interface Vector3D {\n  x: number\n  y: number\n  z: number\n  toString(): string\n}\n\nexport const toVector3D = (v: Vector3) => {\n  return {\n    x: v.x,\n    y: v.y,\n    z: v.z,\n    toString() {\n      return `${this.x}m ${this.y}m ${this.z}m`;\n    }\n  };\n};\n\nexport interface Vector2D {\n  u: number\n  v: number\n  toString(): string\n}\n\nexport const toVector2D = (v: Vector2) => {\n  return {\n    u: v.x,\n    v: v.y,\n    toString() {\n      return `${this.u} ${this.v}`;\n    }\n  };\n};\n\ninterface ToBlobOptions {\n  mimeType?: string, qualityArgument?: number, idealAspect?: boolean\n}\n\nexport interface FramingInfo {\n  framedRadius: number;\n  fieldOfViewAspect: number;\n}\n\nexport interface Camera {\n  viewMatrix: Array<number>;\n  projectionMatrix: Array<number>;\n}\n\nexport interface RendererInterface {\n  load(progressCallback: (progress: number) => void): Promise<FramingInfo>;\n  render(camera: Camera): void;\n  resize(width: number, height: number): void;\n}\n\n/**\n * Definition for a basic <model-viewer> element.\n */\nexport default class ModelViewerElementBase extends ReactiveElement {\n  static get is() {\n    return 'model-viewer';\n  }\n\n  /** @export */\n  static set modelCacheSize(value: number) {\n    CachingGLTFLoader[$evictionPolicy].evictionThreshold = value;\n  }\n\n  /** @export */\n  static get modelCacheSize(): number {\n    return CachingGLTFLoader[$evictionPolicy].evictionThreshold\n  }\n\n  /** @export */\n  static set minimumRenderScale(value: number) {\n    if (value > 1) {\n      console.warn(\n          '<model-viewer> minimumRenderScale has been clamped to a maximum value of 1.');\n    }\n    if (value <= 0) {\n      console.warn(\n          '<model-viewer> minimumRenderScale has been clamped to a minimum value of 0.25.');\n    }\n    Renderer.singleton.minScale = value;\n  }\n\n  /** @export */\n  static get minimumRenderScale(): number {\n    return Renderer.singleton.minScale;\n  }\n\n  @property({type: String}) alt: string|null = null;\n\n  @property({type: String}) src: string|null = null;\n\n  @property({type: Boolean, attribute: 'with-credentials'})\n  withCredentials: boolean = false;\n\n  /**\n   * Generates a 3D model schema https://schema.org/3DModel associated with\n   * the loaded src and inserts it into the header of the page for search\n   * engines to crawl.\n   */\n  @property({type: Boolean, attribute: 'generate-schema'})\n  generateSchema = false;\n\n  protected[$isElementInViewport] = false;\n  protected[$loaded] = false;\n  protected[$loadedTime] = 0;\n  protected[$scene]: ModelScene;\n  protected[$container]: HTMLDivElement;\n  protected[$userInputElement]: HTMLDivElement;\n  protected[$canvas]: HTMLCanvasElement;\n  protected[$statusElement]: HTMLSpanElement;\n  protected[$status] = '';\n  protected[$defaultAriaLabel]: string;\n  protected[$clearModelTimeout]: number|null = null;\n\n  protected[$fallbackResizeHandler] = debounce(() => {\n    const boundingRect = this.getBoundingClientRect();\n    this[$updateSize](boundingRect);\n  }, FALLBACK_SIZE_UPDATE_THRESHOLD_MS);\n\n  protected[$announceModelVisibility] = debounce((oldVisibility: boolean) => {\n    const newVisibility = this.modelIsVisible;\n    if (newVisibility !== oldVisibility) {\n      this.dispatchEvent(new CustomEvent(\n          'model-visibility', {detail: {visible: newVisibility}}));\n    }\n  }, ANNOUNCE_MODEL_VISIBILITY_DEBOUNCE_THRESHOLD);\n\n  protected[$resizeObserver]: ResizeObserver|null = null;\n  protected[$intersectionObserver]: IntersectionObserver|null = null;\n\n  protected[$progressTracker]: ProgressTracker = new ProgressTracker();\n\n  /** @export */\n  get loaded() {\n    return this[$getLoaded]();\n  }\n\n  get[$renderer]() {\n    return Renderer.singleton;\n  }\n\n  /** @export */\n  get modelIsVisible() {\n    return this[$getModelIsVisible]();\n  }\n\n  /**\n   * Creates a new ModelViewerElement.\n   */\n  constructor() {\n    super();\n\n    this.attachShadow({mode: 'open'});\n\n    const shadowRoot = this.shadowRoot!;\n\n    makeTemplate(shadowRoot);\n\n    this[$container] = shadowRoot.querySelector('.container') as HTMLDivElement;\n    this[$userInputElement] =\n        shadowRoot.querySelector('.userInput') as HTMLDivElement;\n    this[$canvas] = shadowRoot.querySelector('canvas') as HTMLCanvasElement;\n    this[$statusElement] =\n        shadowRoot.querySelector('#status') as HTMLSpanElement;\n    this[$defaultAriaLabel] =\n        this[$userInputElement].getAttribute('aria-label')!;\n\n    // Because of potential race conditions related to invoking the constructor\n    // we only use the bounding rect to set the initial size if the element is\n    // already connected to the document:\n    let width, height;\n    if (this.isConnected) {\n      const rect = this.getBoundingClientRect();\n      width = rect.width;\n      height = rect.height;\n    } else {\n      width = UNSIZED_MEDIA_WIDTH;\n      height = UNSIZED_MEDIA_HEIGHT;\n    }\n\n    // Create the underlying ModelScene.\n    this[$scene] =\n        new ModelScene({canvas: this[$canvas], element: this, width, height});\n\n    // Update initial size on microtask timing so that subclasses have a\n    // chance to initialize\n    Promise.resolve().then(() => {\n      this[$updateSize](this.getBoundingClientRect());\n    });\n\n    if (HAS_RESIZE_OBSERVER) {\n      // Set up a resize observer so we can scale our canvas\n      // if our <model-viewer> changes\n      this[$resizeObserver] =\n          new ResizeObserver((entries: Array<ResizeObserverEntry>) => {\n            // Don't resize anything if in AR mode; otherwise the canvas\n            // scaling to fullscreen on entering AR will clobber the flat/2d\n            // dimensions of the element.\n            if (this[$renderer].isPresenting) {\n              return;\n            }\n\n            for (let entry of entries) {\n              if (entry.target === this) {\n                this[$updateSize](entry.contentRect);\n              }\n            }\n          });\n    }\n\n    if (HAS_INTERSECTION_OBSERVER) {\n      this[$intersectionObserver] = new IntersectionObserver(entries => {\n        for (let entry of entries) {\n          if (entry.target === this) {\n            const oldVisibility = this.modelIsVisible;\n            this[$isElementInViewport] = entry.isIntersecting;\n            this[$announceModelVisibility](oldVisibility);\n            if (this[$isElementInViewport] && !this.loaded) {\n              this[$updateSource]();\n            }\n          }\n        }\n      }, {\n        root: null,\n        // We used to have margin here, but it was causing animated models below\n        // the fold to steal the frame budget. Weirder still, it would also\n        // cause input events to be swallowed, sometimes for seconds on the\n        // model above the fold, but only when the animated model was completely\n        // below. Setting this margin to zero fixed it.\n        rootMargin: '0px',\n        // With zero threshold, an element adjacent to but not intersecting the\n        // viewport will be reported as intersecting, which will cause\n        // unnecessary rendering. Any slight positive threshold alleviates this.\n        threshold: 0.00001,\n      });\n    } else {\n      // If there is no intersection observer, then all models should be visible\n      // at all times:\n      this[$isElementInViewport] = true;\n    }\n  }\n\n  connectedCallback() {\n    super.connectedCallback && super.connectedCallback();\n    if (HAS_RESIZE_OBSERVER) {\n      this[$resizeObserver]!.observe(this);\n    } else {\n      self.addEventListener('resize', this[$fallbackResizeHandler]);\n    }\n\n    if (HAS_INTERSECTION_OBSERVER) {\n      this[$intersectionObserver]!.observe(this);\n    }\n\n    this.addEventListener('focus', this[$onFocus]);\n    this.addEventListener('blur', this[$onBlur]);\n\n    const renderer = this[$renderer];\n    renderer.addEventListener(\n        'contextlost', this[$onContextLost] as (event: ThreeEvent) => void);\n\n    renderer.registerScene(this[$scene]);\n\n    if (this[$clearModelTimeout] != null) {\n      self.clearTimeout(this[$clearModelTimeout]!);\n      this[$clearModelTimeout] = null;\n      // Force an update in case the model has been evicted from our GLTF cache\n      // @see https://lit-element.polymer-project.org/guide/lifecycle#requestupdate\n      this.requestUpdate('src', null);\n    }\n  }\n\n  disconnectedCallback() {\n    super.disconnectedCallback && super.disconnectedCallback();\n    if (HAS_RESIZE_OBSERVER) {\n      this[$resizeObserver]!.unobserve(this);\n    } else {\n      self.removeEventListener('resize', this[$fallbackResizeHandler]);\n    }\n\n    if (HAS_INTERSECTION_OBSERVER) {\n      this[$intersectionObserver]!.unobserve(this);\n    }\n\n    this.removeEventListener('focus', this[$onFocus]);\n    this.removeEventListener('blur', this[$onBlur]);\n\n    const renderer = this[$renderer];\n    renderer.removeEventListener(\n        'contextlost', this[$onContextLost] as (event: ThreeEvent) => void);\n\n    renderer.unregisterScene(this[$scene]);\n\n    this[$clearModelTimeout] = self.setTimeout(() => {\n      this[$scene].dispose();\n      this[$clearModelTimeout] = null;\n    }, CLEAR_MODEL_TIMEOUT_MS);\n  }\n\n  updated(changedProperties: Map<string|number|symbol, any>) {\n    super.updated(changedProperties);\n\n    // NOTE(cdata): If a property changes from values A -> B -> A in the space\n    // of a microtask, LitElement/UpdatingElement will notify of a change even\n    // though the value has effectively not changed, so we need to check to make\n    // sure that the value has actually changed before changing the loaded flag.\n    if (changedProperties.has('src')) {\n      if (this.src == null) {\n        this[$loaded] = false;\n        this[$loadedTime] = 0;\n        this[$scene].reset();\n      } else if (this.src !== this[$scene].url) {\n        this[$loaded] = false;\n        this[$loadedTime] = 0;\n        this[$updateSource]();\n      }\n    }\n\n    if (changedProperties.has('alt')) {\n      this[$userInputElement].setAttribute('aria-label', this[$ariaLabel]);\n    }\n\n    if (changedProperties.has('withCredentials')) {\n      CachingGLTFLoader.withCredentials = this.withCredentials\n    }\n\n    if (changedProperties.has('generateSchema')) {\n      if (this.generateSchema) {\n        this[$scene].updateSchema(this.src);\n      } else {\n        this[$scene].updateSchema(null);\n      }\n    }\n  }\n\n  /** @export */\n  toDataURL(type?: string, encoderOptions?: number): string {\n    return this[$renderer]\n        .displayCanvas(this[$scene])\n        .toDataURL(type, encoderOptions);\n  }\n\n  /** @export */\n  async toBlob(options?: ToBlobOptions): Promise<Blob> {\n    const mimeType = options ? options.mimeType : undefined;\n    const qualityArgument = options ? options.qualityArgument : undefined;\n    const useIdealAspect = options ? options.idealAspect : undefined;\n\n    const {width, height, idealAspect, aspect} = this[$scene];\n    const {dpr, scaleFactor} = this[$renderer];\n    let outputWidth = width * scaleFactor * dpr;\n    let outputHeight = height * scaleFactor * dpr;\n    let offsetX = 0;\n    let offsetY = 0;\n    if (useIdealAspect === true) {\n      if (idealAspect > aspect) {\n        const oldHeight = outputHeight;\n        outputHeight = Math.round(outputWidth / idealAspect);\n        offsetY = (oldHeight - outputHeight) / 2;\n      } else {\n        const oldWidth = outputWidth;\n        outputWidth = Math.round(outputHeight * idealAspect);\n        offsetX = (oldWidth - outputWidth) / 2;\n      }\n    }\n    blobCanvas.width = outputWidth;\n    blobCanvas.height = outputHeight;\n    try {\n      return new Promise<Blob>(async (resolve, reject) => {\n        blobCanvas.getContext('2d')!.drawImage(\n            this[$renderer].displayCanvas(this[$scene]),\n            offsetX,\n            offsetY,\n            outputWidth,\n            outputHeight,\n            0,\n            0,\n            outputWidth,\n            outputHeight);\n        if ((blobCanvas as any).msToBlob) {\n          // NOTE: msToBlob only returns image/png\n          // so ensure mimeType is not specified (defaults to image/png)\n          // or is image/png, otherwise fallback to using toDataURL on IE.\n          if (!mimeType || mimeType === 'image/png') {\n            return resolve((blobCanvas as any).msToBlob());\n          }\n        }\n\n        if (!blobCanvas.toBlob) {\n          return resolve(await dataUrlToBlob(\n              blobCanvas.toDataURL(mimeType, qualityArgument)));\n        }\n\n        blobCanvas.toBlob((blob) => {\n          if (!blob) {\n            return reject(new Error('Unable to retrieve canvas blob'));\n          }\n\n          resolve(blob);\n        }, mimeType, qualityArgument);\n      });\n    } finally {\n      this[$updateSize]({width, height});\n    };\n  }\n\n  registerRenderer(renderer: RendererInterface) {\n    this[$scene].externalRenderer = renderer;\n  }\n\n  unregisterRenderer() {\n    this[$scene].externalRenderer = null;\n  }\n\n  get[$ariaLabel]() {\n    return this[$altDefaulted];\n  }\n\n  get[$altDefaulted]() {\n    return (this.alt == null || this.alt === 'null') ? this[$defaultAriaLabel] :\n                                                       this.alt;\n  }\n\n  // NOTE(cdata): Although this may seem extremely redundant, it is required in\n  // order to support overloading when TypeScript is compiled to ES5\n  // @see https://github.com/Polymer/lit-element/pull/745\n  // @see https://github.com/microsoft/TypeScript/issues/338\n  [$getLoaded](): boolean {\n    return this[$loaded];\n  }\n\n  // @see [$getLoaded]\n  [$getModelIsVisible](): boolean {\n    return this.loaded && this[$isElementInViewport];\n  }\n\n  [$shouldAttemptPreload](): boolean {\n    return !!this.src && this[$isElementInViewport];\n  }\n\n  /**\n   * Called on initialization and when the resize observer fires.\n   */\n  [$updateSize]({width, height}: {width: any, height: any}) {\n    this[$container].style.width = `${width}px`;\n    this[$container].style.height = `${height}px`;\n\n    this[$onResize]({width: parseFloat(width), height: parseFloat(height)});\n  }\n\n  [$tick](_time: number, _delta: number) {\n  }\n\n  [$markLoaded]() {\n    if (this[$loaded]) {\n      return;\n    }\n\n    this[$loaded] = true;\n    this[$loadedTime] = performance.now();\n  }\n\n  [$needsRender]() {\n    this[$scene].queueRender();\n  }\n\n  [$onModelLoad]() {\n  }\n\n  [$updateStatus](status: string) {\n    this[$status] = status;\n    const rootNode = this.getRootNode() as Document | ShadowRoot | null;\n    // Only change the aria-label if <model-viewer> is currently focused:\n    if (rootNode != null && rootNode.activeElement === this &&\n        this[$statusElement].textContent != status) {\n      this[$statusElement].textContent = status;\n    }\n  }\n\n  [$onFocus] = () => {\n    this[$statusElement].textContent = this[$status];\n  };\n\n  [$onBlur] = () => {\n    this[$statusElement].textContent = '';\n  };\n\n  [$onResize](e: {width: number, height: number}) {\n    this[$scene].setSize(e.width, e.height);\n  }\n\n  [$onContextLost] = (event: ContextLostEvent) => {\n    this.dispatchEvent(new CustomEvent(\n        'error',\n        {detail: {type: 'webglcontextlost', sourceError: event.sourceEvent}}));\n  };\n\n  /**\n   * Parses the element for an appropriate source URL and\n   * sets the views to use the new model based.\n   */\n  async[$updateSource]() {\n    const scene = this[$scene];\n    if (this.loaded || !this[$shouldAttemptPreload]() ||\n        this.src === scene.url) {\n      return;\n    }\n\n    if (this.generateSchema) {\n      scene.updateSchema(this.src);\n    }\n    this[$updateStatus]('Loading');\n    // If we are loading a new model, we need to stop the animation of\n    // the current one (if any is playing). Otherwise, we might lose\n    // the reference to the scene root and running actions start to\n    // throw exceptions and/or behave in unexpected ways:\n    scene.stopAnimation();\n\n    const updateSourceProgress = this[$progressTracker].beginActivity();\n    const source = this.src;\n    try {\n      const srcUpdated = scene.setSource(\n          source,\n          (progress: number) =>\n              updateSourceProgress(clamp(progress, 0, 1) * 0.95));\n\n      const envUpdated = (this as any)[$updateEnvironment]();\n\n      await Promise.all([srcUpdated, envUpdated]);\n\n      this[$markLoaded]();\n      this[$onModelLoad]();\n\n      // Wait for shaders to compile and pixels to be drawn.\n      await new Promise<void>(resolve => {\n        requestAnimationFrame(() => {\n          requestAnimationFrame(() => {\n            this.dispatchEvent(\n                new CustomEvent('load', {detail: {url: source}}));\n            resolve();\n          });\n        });\n      });\n    } catch (error) {\n      this.dispatchEvent(new CustomEvent(\n          'error', {detail: {type: 'loadfailure', sourceError: error}}));\n    } finally {\n      updateSourceProgress(1.0);\n    }\n  }\n}\n"]}