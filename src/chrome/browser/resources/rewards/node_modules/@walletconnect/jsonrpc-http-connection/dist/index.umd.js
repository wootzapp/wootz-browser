(function(b,E){typeof exports=="object"&&typeof module<"u"?E(exports):typeof define=="function"&&define.amd?define(["exports"],E):(b=typeof globalThis<"u"?globalThis:b||self,E(b["@walletconnect/jsonrpc-http-connection"]={}))})(this,function(b){"use strict";var E=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function he(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var j={exports:{}},w=typeof Reflect=="object"?Reflect:null,I=w&&typeof w.apply=="function"?w.apply:function(e,r,o){return Function.prototype.apply.call(e,r,o)},P;w&&typeof w.ownKeys=="function"?P=w.ownKeys:Object.getOwnPropertySymbols?P=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:P=function(e){return Object.getOwnPropertyNames(e)};function de(t){console&&console.warn&&console.warn(t)}var N=Number.isNaN||function(e){return e!==e};function c(){c.init.call(this)}j.exports=c,j.exports.once=be,c.EventEmitter=c,c.prototype._events=void 0,c.prototype._eventsCount=0,c.prototype._maxListeners=void 0;var F=10;function A(t){if(typeof t!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}Object.defineProperty(c,"defaultMaxListeners",{enumerable:!0,get:function(){return F},set:function(t){if(typeof t!="number"||t<0||N(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");F=t}}),c.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},c.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||N(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function $(t){return t._maxListeners===void 0?c.defaultMaxListeners:t._maxListeners}c.prototype.getMaxListeners=function(){return $(this)},c.prototype.emit=function(e){for(var r=[],o=1;o<arguments.length;o++)r.push(arguments[o]);var s=e==="error",f=this._events;if(f!==void 0)s=s&&f.error===void 0;else if(!s)return!1;if(s){var a;if(r.length>0&&(a=r[0]),a instanceof Error)throw a;var h=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw h.context=a,h}var m=f[e];if(m===void 0)return!1;if(typeof m=="function")I(m,this,r);else for(var R=m.length,C=G(m,R),o=0;o<R;++o)I(C[o],this,r);return!0};function H(t,e,r,o){var s,f,a;if(A(r),f=t._events,f===void 0?(f=t._events=Object.create(null),t._eventsCount=0):(f.newListener!==void 0&&(t.emit("newListener",e,r.listener?r.listener:r),f=t._events),a=f[e]),a===void 0)a=f[e]=r,++t._eventsCount;else if(typeof a=="function"?a=f[e]=o?[r,a]:[a,r]:o?a.unshift(r):a.push(r),s=$(t),s>0&&a.length>s&&!a.warned){a.warned=!0;var h=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");h.name="MaxListenersExceededWarning",h.emitter=t,h.type=e,h.count=a.length,de(h)}return t}c.prototype.addListener=function(e,r){return H(this,e,r,!1)},c.prototype.on=c.prototype.addListener,c.prototype.prependListener=function(e,r){return H(this,e,r,!0)};function pe(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function q(t,e,r){var o={fired:!1,wrapFn:void 0,target:t,type:e,listener:r},s=pe.bind(o);return s.listener=r,o.wrapFn=s,s}c.prototype.once=function(e,r){return A(r),this.on(e,q(this,e,r)),this},c.prototype.prependOnceListener=function(e,r){return A(r),this.prependListener(e,q(this,e,r)),this},c.prototype.removeListener=function(e,r){var o,s,f,a,h;if(A(r),s=this._events,s===void 0)return this;if(o=s[e],o===void 0)return this;if(o===r||o.listener===r)--this._eventsCount===0?this._events=Object.create(null):(delete s[e],s.removeListener&&this.emit("removeListener",e,o.listener||r));else if(typeof o!="function"){for(f=-1,a=o.length-1;a>=0;a--)if(o[a]===r||o[a].listener===r){h=o[a].listener,f=a;break}if(f<0)return this;f===0?o.shift():ye(o,f),o.length===1&&(s[e]=o[0]),s.removeListener!==void 0&&this.emit("removeListener",e,h||r)}return this},c.prototype.off=c.prototype.removeListener,c.prototype.removeAllListeners=function(e){var r,o,s;if(o=this._events,o===void 0)return this;if(o.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):o[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete o[e]),this;if(arguments.length===0){var f=Object.keys(o),a;for(s=0;s<f.length;++s)a=f[s],a!=="removeListener"&&this.removeAllListeners(a);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(r=o[e],typeof r=="function")this.removeListener(e,r);else if(r!==void 0)for(s=r.length-1;s>=0;s--)this.removeListener(e,r[s]);return this};function k(t,e,r){var o=t._events;if(o===void 0)return[];var s=o[e];return s===void 0?[]:typeof s=="function"?r?[s.listener||s]:[s]:r?ve(s):G(s,s.length)}c.prototype.listeners=function(e){return k(this,e,!0)},c.prototype.rawListeners=function(e){return k(this,e,!1)},c.listenerCount=function(t,e){return typeof t.listenerCount=="function"?t.listenerCount(e):V.call(t,e)},c.prototype.listenerCount=V;function V(t){var e=this._events;if(e!==void 0){var r=e[t];if(typeof r=="function")return 1;if(r!==void 0)return r.length}return 0}c.prototype.eventNames=function(){return this._eventsCount>0?P(this._events):[]};function G(t,e){for(var r=new Array(e),o=0;o<e;++o)r[o]=t[o];return r}function ye(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}function ve(t){for(var e=new Array(t.length),r=0;r<e.length;++r)e[r]=t[r].listener||t[r];return e}function be(t,e){return new Promise(function(r,o){function s(a){t.removeListener(e,f),o(a)}function f(){typeof t.removeListener=="function"&&t.removeListener("error",s),r([].slice.call(arguments))}K(t,e,f,{once:!0}),e!=="error"&&me(t,s,{once:!0})})}function me(t,e,r){typeof t.on=="function"&&K(t,"error",e,r)}function K(t,e,r,o){if(typeof t.on=="function")o.once?t.once(e,r):t.on(e,r);else if(typeof t.addEventListener=="function")t.addEventListener(e,function s(f){o.once&&t.removeEventListener(e,s),r(f)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t)}var x={exports:{}};(function(t,e){var r=typeof self<"u"?self:E,o=function(){function f(){this.fetch=!1,this.DOMException=r.DOMException}return f.prototype=r,new f}();(function(f){(function(a){var h={searchParams:"URLSearchParams"in f,iterable:"Symbol"in f&&"iterator"in Symbol,blob:"FileReader"in f&&"Blob"in f&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in f,arrayBuffer:"ArrayBuffer"in f};function m(n){return n&&DataView.prototype.isPrototypeOf(n)}if(h.arrayBuffer)var R=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],C=ArrayBuffer.isView||function(n){return n&&R.indexOf(Object.prototype.toString.call(n))>-1};function _(n){if(typeof n!="string"&&(n=String(n)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(n))throw new TypeError("Invalid character in header field name");return n.toLowerCase()}function fe(n){return typeof n!="string"&&(n=String(n)),n}function D(n){var i={next:function(){var u=n.shift();return{done:u===void 0,value:u}}};return h.iterable&&(i[Symbol.iterator]=function(){return i}),i}function d(n){this.map={},n instanceof d?n.forEach(function(i,u){this.append(u,i)},this):Array.isArray(n)?n.forEach(function(i){this.append(i[0],i[1])},this):n&&Object.getOwnPropertyNames(n).forEach(function(i){this.append(i,n[i])},this)}d.prototype.append=function(n,i){n=_(n),i=fe(i);var u=this.map[n];this.map[n]=u?u+", "+i:i},d.prototype.delete=function(n){delete this.map[_(n)]},d.prototype.get=function(n){return n=_(n),this.has(n)?this.map[n]:null},d.prototype.has=function(n){return this.map.hasOwnProperty(_(n))},d.prototype.set=function(n,i){this.map[_(n)]=fe(i)},d.prototype.forEach=function(n,i){for(var u in this.map)this.map.hasOwnProperty(u)&&n.call(i,this.map[u],u,this)},d.prototype.keys=function(){var n=[];return this.forEach(function(i,u){n.push(u)}),D(n)},d.prototype.values=function(){var n=[];return this.forEach(function(i){n.push(i)}),D(n)},d.prototype.entries=function(){var n=[];return this.forEach(function(i,u){n.push([u,i])}),D(n)},h.iterable&&(d.prototype[Symbol.iterator]=d.prototype.entries);function M(n){if(n.bodyUsed)return Promise.reject(new TypeError("Already read"));n.bodyUsed=!0}function ue(n){return new Promise(function(i,u){n.onload=function(){i(n.result)},n.onerror=function(){u(n.error)}})}function We(n){var i=new FileReader,u=ue(i);return i.readAsArrayBuffer(n),u}function Xe(n){var i=new FileReader,u=ue(i);return i.readAsText(n),u}function Qe(n){for(var i=new Uint8Array(n),u=new Array(i.length),y=0;y<i.length;y++)u[y]=String.fromCharCode(i[y]);return u.join("")}function ce(n){if(n.slice)return n.slice(0);var i=new Uint8Array(n.byteLength);return i.set(new Uint8Array(n)),i.buffer}function le(){return this.bodyUsed=!1,this._initBody=function(n){this._bodyInit=n,n?typeof n=="string"?this._bodyText=n:h.blob&&Blob.prototype.isPrototypeOf(n)?this._bodyBlob=n:h.formData&&FormData.prototype.isPrototypeOf(n)?this._bodyFormData=n:h.searchParams&&URLSearchParams.prototype.isPrototypeOf(n)?this._bodyText=n.toString():h.arrayBuffer&&h.blob&&m(n)?(this._bodyArrayBuffer=ce(n.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):h.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(n)||C(n))?this._bodyArrayBuffer=ce(n):this._bodyText=n=Object.prototype.toString.call(n):this._bodyText="",this.headers.get("content-type")||(typeof n=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):h.searchParams&&URLSearchParams.prototype.isPrototypeOf(n)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},h.blob&&(this.blob=function(){var n=M(this);if(n)return n;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?M(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(We)}),this.text=function(){var n=M(this);if(n)return n;if(this._bodyBlob)return Xe(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(Qe(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},h.formData&&(this.formData=function(){return this.text().then(et)}),this.json=function(){return this.text().then(JSON.parse)},this}var Ye=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function Ze(n){var i=n.toUpperCase();return Ye.indexOf(i)>-1?i:n}function g(n,i){i=i||{};var u=i.body;if(n instanceof g){if(n.bodyUsed)throw new TypeError("Already read");this.url=n.url,this.credentials=n.credentials,i.headers||(this.headers=new d(n.headers)),this.method=n.method,this.mode=n.mode,this.signal=n.signal,!u&&n._bodyInit!=null&&(u=n._bodyInit,n.bodyUsed=!0)}else this.url=String(n);if(this.credentials=i.credentials||this.credentials||"same-origin",(i.headers||!this.headers)&&(this.headers=new d(i.headers)),this.method=Ze(i.method||this.method||"GET"),this.mode=i.mode||this.mode||null,this.signal=i.signal||this.signal,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&u)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(u)}g.prototype.clone=function(){return new g(this,{body:this._bodyInit})};function et(n){var i=new FormData;return n.trim().split("&").forEach(function(u){if(u){var y=u.split("="),p=y.shift().replace(/\+/g," "),l=y.join("=").replace(/\+/g," ");i.append(decodeURIComponent(p),decodeURIComponent(l))}}),i}function tt(n){var i=new d,u=n.replace(/\r?\n[\t ]+/g," ");return u.split(/\r?\n/).forEach(function(y){var p=y.split(":"),l=p.shift().trim();if(l){var T=p.join(":").trim();i.append(l,T)}}),i}le.call(g.prototype);function v(n,i){i||(i={}),this.type="default",this.status=i.status===void 0?200:i.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in i?i.statusText:"OK",this.headers=new d(i.headers),this.url=i.url||"",this._initBody(n)}le.call(v.prototype),v.prototype.clone=function(){return new v(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new d(this.headers),url:this.url})},v.error=function(){var n=new v(null,{status:0,statusText:""});return n.type="error",n};var rt=[301,302,303,307,308];v.redirect=function(n,i){if(rt.indexOf(i)===-1)throw new RangeError("Invalid status code");return new v(null,{status:i,headers:{location:n}})},a.DOMException=f.DOMException;try{new a.DOMException}catch{a.DOMException=function(i,u){this.message=i,this.name=u;var y=Error(i);this.stack=y.stack},a.DOMException.prototype=Object.create(Error.prototype),a.DOMException.prototype.constructor=a.DOMException}function S(n,i){return new Promise(function(u,y){var p=new g(n,i);if(p.signal&&p.signal.aborted)return y(new a.DOMException("Aborted","AbortError"));var l=new XMLHttpRequest;function T(){l.abort()}l.onload=function(){var L={status:l.status,statusText:l.statusText,headers:tt(l.getAllResponseHeaders()||"")};L.url="responseURL"in l?l.responseURL:L.headers.get("X-Request-URL");var U="response"in l?l.response:l.responseText;u(new v(U,L))},l.onerror=function(){y(new TypeError("Network request failed"))},l.ontimeout=function(){y(new TypeError("Network request failed"))},l.onabort=function(){y(new a.DOMException("Aborted","AbortError"))},l.open(p.method,p.url,!0),p.credentials==="include"?l.withCredentials=!0:p.credentials==="omit"&&(l.withCredentials=!1),"responseType"in l&&h.blob&&(l.responseType="blob"),p.headers.forEach(function(L,U){l.setRequestHeader(U,L)}),p.signal&&(p.signal.addEventListener("abort",T),l.onreadystatechange=function(){l.readyState===4&&p.signal.removeEventListener("abort",T)}),l.send(typeof p._bodyInit>"u"?null:p._bodyInit)})}return S.polyfill=!0,f.fetch||(f.fetch=S,f.Headers=d,f.Request=g,f.Response=v),a.Headers=d,a.Request=g,a.Response=v,a.fetch=S,Object.defineProperty(a,"__esModule",{value:!0}),a})({})})(o),o.fetch.ponyfill=!0,delete o.fetch.polyfill;var s=o;e=s.fetch,e.default=s.fetch,e.fetch=s.fetch,e.Headers=s.Headers,e.Request=s.Request,e.Response=s.Response,t.exports=e})(x,x.exports);var z=he(x.exports);const ge=t=>JSON.stringify(t,(e,r)=>typeof r=="bigint"?r.toString()+"n":r),we=t=>{const e=new RegExp('(?<!")(?<=:)\\b(\\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))(?=[,\\}\\]]|$)',"g"),r=t.replace(e,o=>`"${o}n"`);return JSON.parse(r,(o,s)=>typeof s=="string"&&s.match(/^\d+n$/)?BigInt(s.substring(0,s.length-1)):s)};function Ee(t){if(typeof t!="string")throw new Error(`Cannot safe json parse value of type ${typeof t}`);try{return we(t)}catch(e){return console.error("safeJsonParse error:",e),t}}function J(t){return typeof t=="string"?t:ge(t)||""}const Oe="PARSE_ERROR",_e="INVALID_REQUEST",Le="METHOD_NOT_FOUND",Pe="INVALID_PARAMS",W="INTERNAL_ERROR",B="SERVER_ERROR",Ae=[-32700,-32600,-32601,-32602,-32603],O={[Oe]:{code:-32700,message:"Parse error"},[_e]:{code:-32600,message:"Invalid Request"},[Le]:{code:-32601,message:"Method not found"},[Pe]:{code:-32602,message:"Invalid params"},[W]:{code:-32603,message:"Internal error"},[B]:{code:-32e3,message:"Server error"}},X=B;function Re(t){return Ae.includes(t)}function Q(t){return Object.keys(O).includes(t)?O[t]:O[X]}function Te(t){return Object.values(O).find(e=>e.code===t)||O[X]}function je(t,e,r){return t.message.includes("getaddrinfo ENOTFOUND")||t.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${r} RPC url at ${e}`):t}var xe=Object.defineProperty,Be=Object.defineProperties,Ce=Object.getOwnPropertyDescriptors,Y=Object.getOwnPropertySymbols,De=Object.prototype.hasOwnProperty,Me=Object.prototype.propertyIsEnumerable,Z=(t,e,r)=>e in t?xe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Se=(t,e)=>{for(var r in e||(e={}))De.call(e,r)&&Z(t,r,e[r]);if(Y)for(var r of Y(e))Me.call(e,r)&&Z(t,r,e[r]);return t},Ue=(t,e)=>Be(t,Ce(e));function Ie(t,e,r){return{id:t,jsonrpc:"2.0",error:Ne(e,r)}}function Ne(t,e){return typeof t>"u"?Q(W):(typeof t=="string"&&(t=Ue(Se({},Q(B)),{message:t})),typeof e<"u"&&(t.data=e),Re(t.code)&&(t=Te(t.code)),t)}const Fe="^https?:";function $e(t){const e=t.match(new RegExp(/^\w+:/,"gi"));if(!(!e||!e.length))return e[0]}function He(t,e){const r=$e(t);return typeof r>"u"?!1:new RegExp(e).test(r)}function ee(t){return He(t,Fe)}var qe=Object.defineProperty,ke=Object.defineProperties,Ve=Object.getOwnPropertyDescriptors,te=Object.getOwnPropertySymbols,Ge=Object.prototype.hasOwnProperty,Ke=Object.prototype.propertyIsEnumerable,re=(t,e,r)=>e in t?qe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ne=(t,e)=>{for(var r in e||(e={}))Ge.call(e,r)&&re(t,r,e[r]);if(te)for(var r of te(e))Ke.call(e,r)&&re(t,r,e[r]);return t},ie=(t,e)=>ke(t,Ve(e));const ze={Accept:"application/json","Content-Type":"application/json"},Je="POST",oe={headers:ze,method:Je},se=10;class ae{constructor(e,r=!1){if(this.url=e,this.disableProviderPing=r,this.events=new j.exports.EventEmitter,this.isAvailable=!1,this.registering=!1,!ee(e))throw new Error(`Provided URL is not compatible with HTTP connection: ${e}`);this.url=e,this.disableProviderPing=r}get connected(){return this.isAvailable}get connecting(){return this.registering}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async open(e=this.url){await this.register(e)}async close(){if(!this.isAvailable)throw new Error("Connection already closed");this.onClose()}async send(e){this.isAvailable||await this.register();try{const r=J(e),o=await(await z(this.url,ie(ne({},oe),{body:r}))).json();this.onPayload({data:o})}catch(r){this.onError(e.id,r)}}async register(e=this.url){if(!ee(e))throw new Error(`Provided URL is not compatible with HTTP connection: ${e}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((o,s)=>{this.events.once("register_error",f=>{this.resetMaxListeners(),s(f)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.isAvailable>"u")return s(new Error("HTTP connection is missing or invalid"));o()})})}this.url=e,this.registering=!0;try{if(!this.disableProviderPing){const r=J({id:1,jsonrpc:"2.0",method:"test",params:[]});await z(e,ie(ne({},oe),{body:r}))}this.onOpen()}catch(r){const o=this.parseError(r);throw this.events.emit("register_error",o),this.onClose(),o}}onOpen(){this.isAvailable=!0,this.registering=!1,this.events.emit("open")}onClose(){this.isAvailable=!1,this.registering=!1,this.events.emit("close")}onPayload(e){if(typeof e.data>"u")return;const r=typeof e.data=="string"?Ee(e.data):e.data;this.events.emit("payload",r)}onError(e,r){const o=this.parseError(r),s=o.message||o.toString(),f=Ie(e,s);this.events.emit("payload",f)}parseError(e,r=this.url){return je(e,r,"HTTP")}resetMaxListeners(){this.events.getMaxListeners()>se&&this.events.setMaxListeners(se)}}b.HttpConnection=ae,b.default=ae,Object.defineProperty(b,"__esModule",{value:!0})});
//# sourceMappingURL=index.umd.js.map
