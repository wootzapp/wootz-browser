"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getCapabilities = getCapabilities;
const coinbaseWebSDK_js_1 = require("../coinbase/coinbaseWebSDK.js");
const index_js_1 = require("../in-app/core/wallet/index.js");
const index_js_2 = require("../injected/index.js");
const index_js_3 = require("../smart/index.js");
const controller_js_1 = require("../wallet-connect/controller.js");
/**
 * Get the capabilities of a wallet based on the [EIP-5792](https://eips.ethereum.org/EIPS/eip-5792) specification.
 *
 * @note This function is dependent on the wallet's support for EIP-5792, but will not throw.
 * **The returned object contains a `message` field detailing any issues with the wallet's support for EIP-5792.**
 *
 * @param {GetCapabilitiesOptions} options
 * @param {Wallet} options.wallet - The wallet to get the capabilities of.
 * @returns {Promise<GetCapabilitiesResult>} - A promise that resolves to the capabilities of the wallet based on the [EIP-5792](https://eips.ethereum.org/EIPS/eip-5792) spec.
 * @beta
 * @example
 * ```ts
 * import { getCapabilities } from "thirdweb/wallets/eip5792";
 *
 * const wallet = createWallet("com.coinbase.wallet");
 * const capabilities = await getCapabilities({ wallet });
 * ```
 *
 * @extension EIP5792
 */
async function getCapabilities({ wallet, }) {
    const account = wallet.getAccount();
    if (!account) {
        return {
            message: `Can't get capabilities, no account connected for wallet: ${wallet.id}`,
        };
    }
    if ((0, index_js_3.isSmartWallet)(wallet)) {
        const { smartWalletGetCapabilities } = await Promise.resolve().then(() => require("../smart/lib/smart-wallet-capabilities.js"));
        return smartWalletGetCapabilities({ wallet });
    }
    if ((0, index_js_1.isInAppWallet)(wallet)) {
        const { inAppWalletGetCapabilities } = await Promise.resolve().then(() => require("../in-app/core/eip5972/in-app-wallet-capabilities.js"));
        return inAppWalletGetCapabilities({ wallet });
    }
    if ((0, coinbaseWebSDK_js_1.isCoinbaseSDKWallet)(wallet)) {
        const { coinbaseSDKWalletGetCapabilities } = await Promise.resolve().then(() => require("../coinbase/coinbaseWebSDK.js"));
        return coinbaseSDKWalletGetCapabilities({ wallet });
    }
    // TODO: Add Wallet Connect support
    if ((0, controller_js_1.isWalletConnect)(wallet)) {
        return {
            message: "getCapabilities is not yet supported with Wallet Connect",
        };
    }
    // Default to injected wallet
    const provider = (0, index_js_2.getInjectedProvider)(wallet.id);
    try {
        return await provider.request({
            method: "wallet_getCapabilities",
            params: [account.address],
        });
    }
    catch (error) {
        if (/unsupport|not support|not available/i.test(error.message)) {
            return {
                message: `${wallet.id} does not support wallet_getCapabilities, reach out to them directly to request EIP-5792 support.`,
            };
        }
        throw error;
    }
}
//# sourceMappingURL=get-capabilities.js.map