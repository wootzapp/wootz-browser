"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getUsdRegistrationPrice = getUsdRegistrationPrice;
const bigint_js_1 = require("../../../utils/bigint.js");
const withCache_js_1 = require("../../../utils/promise/withCache.js");
const units_js_1 = require("../../../utils/units.js");
const usdUnitPrice_js_1 = require("../__generated__/IStorageRegistry/read/usdUnitPrice.js");
const getStorageRegistry_js_1 = require("../contracts/getStorageRegistry.js");
/**
 * Retrieves the current cost to register a Farcaster fid in USD.
 * @param options - An object containing a client to use to fetch the price and the amount of extra storage to include in the returned price.
 * @returns A promise that resolves to the current cost of a Farcaster fid in USD.
 * @extension FARCASTER
 * @example
 * ```ts
 * import { getUsdRegistrationPrice } from "thirdweb/extensions/farcaster";
 *
 * const price = await getUsdRegistrationPrice({
 *  client,
 * });
 * ```
 */
async function getUsdRegistrationPrice(options) {
    const extraStorage = (0, bigint_js_1.toBigInt)(options.extraStorage ?? 0);
    if (extraStorage < 0n) {
        throw new Error(`Expected extraStorage to be greater than or equal to 0, got ${options.extraStorage}`);
    }
    const fetch = async () => {
        const contract = (0, getStorageRegistry_js_1.getStorageRegistry)({
            client: options.client,
            chain: options.chain,
        });
        const bigNumberValue = (await (0, usdUnitPrice_js_1.usdUnitPrice)({ contract })) * (extraStorage + 1n);
        return Number((0, units_js_1.toTokens)(bigNumberValue, 8)); // storage registry uses 8 decimal places
    };
    return (0, withCache_js_1.withCache)(fetch, {
        cacheKey: `${(0, bigint_js_1.toBigInt)(extraStorage)}:getUsdRegistrationPrice`,
        cacheTime: options.disableCache ? 0 : 5 * 60 * 1000, // 5 minutes
    });
}
//# sourceMappingURL=getUsdRegistrationPrice.js.map