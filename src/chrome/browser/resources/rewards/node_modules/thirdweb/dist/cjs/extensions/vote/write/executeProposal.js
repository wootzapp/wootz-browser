"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.executeProposal = executeProposal;
const execute_js_1 = require("../__generated__/Vote/write/execute.js");
const proposalExists_js_1 = require("../read/proposalExists.js");
/**
 * Execute a Proposal
 * @extension VOTE
 * @returns a prepared transaction for the `execute` method
 *
 * @example
 * ```ts
 * import { executeProposal } from "thirdweb/extensions/vote";
 *
 * const transaction = executeProposal({ contract, proposalId });
 * const tx = await sendTransaction({ transaction, account });
 * ```
 */
function executeProposal(options) {
    return (0, execute_js_1.execute)({
        contract: options.contract,
        asyncParams: async () => getExecuteParams(options),
    });
}
/**
 * @internal
 */
async function getExecuteParams(options) {
    const { proposalId } = options;
    const exists = await (0, proposalExists_js_1.proposalExists)(options);
    if (!exists) {
        throw new Error(`Proposal ID: ${proposalId} does not exists`);
    }
    const [{ getAllProposals }, { keccak256 }, { stringToBytes }] = await Promise.all([
        Promise.resolve().then(() => require("../__generated__/Vote/read/getAllProposals.js")),
        Promise.resolve().then(() => require("../../../utils/hashing/keccak256.js")),
        Promise.resolve().then(() => require("../../../utils/encoding/to-bytes.js")),
        Promise.resolve().then(() => require("../__generated__/Vote/write/execute.js")),
    ]);
    // Sadly there isn't a way to fetch a single proposal so we have to load them all
    const _proposals = await getAllProposals(options);
    const proposal = _proposals.find((p) => p.proposalId === proposalId);
    if (!proposal) {
        throw new Error(`Could not find proposalId: ${proposalId}`);
    }
    const { targets, values, calldatas, description } = proposal;
    const descriptionHash = keccak256(stringToBytes(description));
    return {
        descriptionHash,
        targets,
        values,
        calldatas,
    };
}
//# sourceMappingURL=executeProposal.js.map