{"version":3,"file":"static/js/45177.95c178bb.chunk.js","mappings":"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","sources":["../node_modules/thirdweb/src/transaction/actions/gasless/providers/openzeppelin.ts"],"sourcesContent":["import type { Address } from \"abitype\";\nimport type { TransactionSerializable } from \"viem\";\nimport { getContract } from \"../../../../contract/contract.js\";\nimport { isHex } from \"../../../../utils/encoding/helpers/is-hex.js\";\nimport { stringify } from \"../../../../utils/json.js\";\nimport type { Account } from \"../../../../wallets/interfaces/wallet.js\";\nimport type { PreparedTransaction } from \"../../../prepare-transaction.js\";\nimport { readContract } from \"../../../read-contract.js\";\nimport type { WaitForReceiptOptions } from \"../../wait-for-tx-receipt.js\";\n\n/**\n * @transaction\n */\nexport type OpenZeppelinOptions = {\n  provider: \"openzeppelin\";\n  relayerUrl: string;\n  relayerForwarderAddress: Address;\n  domainName?: string; // default: \"GSNv2 Forwarder\"\n  domainVersion?: string; // default: \"0.0.1\"\n  domainSeparatorVersion?: string; // default: \"1\"\n  experimentalChainlessSupport?: boolean; // default: false\n};\n\ntype SendOpenZeppelinTransactionOptions = {\n  account: Account;\n  // TODO: update this to `Transaction<\"prepared\">` once the type is available to ensure only prepared transactions are accepted\n  // biome-ignore lint/suspicious/noExplicitAny: library function that accepts any prepared transaction type\n  transaction: PreparedTransaction<any>;\n  serializableTransaction: TransactionSerializable;\n  gasless: OpenZeppelinOptions;\n};\n\n/**\n * @internal - only exported for testing\n */\nexport async function prepareOpenZeppelinTransaction({\n  account,\n  serializableTransaction,\n  transaction,\n  gasless,\n}: SendOpenZeppelinTransactionOptions) {\n  const forrwaderContract = getContract({\n    address: gasless.relayerForwarderAddress,\n    chain: transaction.chain,\n    client: transaction.client,\n  });\n\n  const nonce = await readContract({\n    contract: forrwaderContract,\n    method: \"function getNonce(address) view returns (uint256)\",\n    params: [account.address],\n  });\n\n  const [signature, message] = await (async () => {\n    // TODO: handle special case for `approve` -> `permit` transactions\n\n    if (!serializableTransaction.to) {\n      throw new Error(\"OpenZeppelin transactions must have a 'to' address\");\n    }\n    if (!serializableTransaction.gas) {\n      throw new Error(\"OpenZeppelin transactions must have a 'gas' value\");\n    }\n    if (!serializableTransaction.data) {\n      throw new Error(\"OpenZeppelin transactions must have a 'data' value\");\n    }\n    // chainless support!\n    if (gasless.experimentalChainlessSupport) {\n      const message = {\n        from: account.address,\n        to: serializableTransaction.to,\n        value: 0n,\n        gas: serializableTransaction.gas,\n        nonce: nonce,\n        data: serializableTransaction.data,\n        chainid: BigInt(transaction.chain.id),\n      } as const;\n      return [\n        await account.signTypedData({\n          domain: {\n            name: \"GSNv2 Forwarder\",\n            version: \"0.0.1\",\n            verifyingContract: forrwaderContract.address,\n          },\n          message,\n          primaryType: \"ForwardRequest\",\n          types: { ForwardRequest: ChainAwareForwardRequest },\n        }),\n        message,\n      ] as const;\n    }\n    // else non-chainless support\n    const message = {\n      from: account.address,\n      to: serializableTransaction.to,\n      value: 0n,\n      gas: serializableTransaction.gas,\n      nonce: nonce,\n      data: serializableTransaction.data,\n    } as const;\n    return [\n      await account.signTypedData({\n        domain: {\n          name: gasless.domainName ?? \"GSNv2 Forwarder\",\n          version: gasless.domainVersion ?? \"0.0.1\",\n          chainId: transaction.chain.id,\n          verifyingContract: forrwaderContract.address,\n        },\n        message,\n        primaryType: \"ForwardRequest\",\n        types: { ForwardRequest },\n      }),\n      message,\n    ] as const;\n  })();\n  // TODO: handle special case for `approve` -> `permit`\n  const messageType = \"forward\";\n\n  return { message, signature, messageType } as const;\n}\n\nconst ForwardRequest = [\n  { name: \"from\", type: \"address\" },\n  { name: \"to\", type: \"address\" },\n  { name: \"value\", type: \"uint256\" },\n  { name: \"gas\", type: \"uint256\" },\n  { name: \"nonce\", type: \"uint256\" },\n  { name: \"data\", type: \"bytes\" },\n] as const;\n\nconst ChainAwareForwardRequest = [\n  { name: \"from\", type: \"address\" },\n  { name: \"to\", type: \"address\" },\n  { name: \"value\", type: \"uint256\" },\n  { name: \"gas\", type: \"uint256\" },\n  { name: \"nonce\", type: \"uint256\" },\n  { name: \"data\", type: \"bytes\" },\n  { name: \"chainid\", type: \"uint256\" },\n] as const;\n\n/**\n * @internal\n */\nexport async function relayOpenZeppelinTransaction(\n  options: SendOpenZeppelinTransactionOptions,\n): Promise<WaitForReceiptOptions> {\n  const { message, messageType, signature } =\n    await prepareOpenZeppelinTransaction(options);\n\n  const response = await fetch(options.gasless.relayerUrl, {\n    method: \"POST\",\n    body: stringify({\n      request: message,\n      type: messageType,\n      signature,\n      forwarderAddress: options.gasless.relayerForwarderAddress,\n    }),\n  });\n\n  if (!response.ok) {\n    response.body?.cancel();\n    throw new Error(`Failed to send transaction: ${await response.text()}`);\n  }\n  const json = await response.json();\n  if (!json.result) {\n    throw new Error(`Relay transaction failed: ${json.message}`);\n  }\n  const transactionHash = JSON.parse(json.result).txHash;\n  if (isHex(transactionHash)) {\n    return {\n      transactionHash,\n      chain: options.transaction.chain,\n      client: options.transaction.client,\n    };\n  }\n\n  throw new Error(`Failed to send transaction: ${stringify(json)}`);\n}\n"],"names":["ForwardRequest","name","type","ChainAwareForwardRequest","async","relayOpenZeppelinTransaction","options","message","messageType","signature","_ref","account","serializableTransaction","transaction","gasless","forrwaderContract","getContract","address","relayerForwarderAddress","chain","client","nonce","readContract","contract","method","params","to","Error","gas","data","experimentalChainlessSupport","from","value","chainid","BigInt","id","signTypedData","domain","version","verifyingContract","primaryType","types","domainName","domainVersion","chainId","prepareOpenZeppelinTransaction","response","fetch","relayerUrl","body","stringify","request","forwarderAddress","ok","cancel","text","json","result","transactionHash","JSON","parse","txHash","isHex"],"sourceRoot":""}